import sys
from functools import lru_cache

input_grid = """......................................................................S......................................................................
.............................................................................................................................................
......................................................................^......................................................................
.............................................................................................................................................
.....................................................................^.^.....................................................................
.............................................................................................................................................
....................................................................^...^....................................................................
.............................................................................................................................................
...................................................................^.....^...................................................................
.............................................................................................................................................
..................................................................^...^...^..................................................................
.............................................................................................................................................
.................................................................^.^...^.^.^.................................................................
.............................................................................................................................................
................................................................^.^.......^.^................................................................
.............................................................................................................................................
...............................................................^...^...^.^.^.^...............................................................
.............................................................................................................................................
..............................................................^.^.^...^.......^..............................................................
.............................................................................................................................................
.............................................................^...^.^.^.^...^.^.^.............................................................
.............................................................................................................................................
............................................................^.^.^.^...^.......^.^............................................................
.............................................................................................................................................
...........................................................^.^.^.^.^.^.^.^.^...^.^...........................................................
.............................................................................................................................................
..........................................................^.....^.^.^.^.^.....^...^..........................................................
.............................................................................................................................................
.........................................................^.^.....^.^.^.^.^...^.^.^.^.........................................................
.............................................................................................................................................
........................................................^.^.^.^.^.^.^.^...^...^.....^........................................................
.............................................................................................................................................
.......................................................^.^.^.^.^.^.^.......^...^.....^.......................................................
.............................................................................................................................................
......................................................^.^.^.^...^.^.....^.^.^.^.^...^.^......................................................
.............................................................................................................................................
.....................................................^.^.^.^.^.^.^.....^.....^...^.^.^.^.....................................................
.............................................................................................................................................
....................................................^.^...^.^.......^.^.^.......^...^.^.^....................................................
.............................................................................................................................................
...................................................^...^.^...^...^.^.^.^.^...^...^.^.....^...................................................
.............................................................................................................................................
..................................................^.....^...^.^.^.....^...^.^...^.......^.^..................................................
.............................................................................................................................................
.................................................^.^.^.^.^.^.^.^...^.^.^.^.^.....^.^...^.^.^.................................................
.............................................................................................................................................
................................................^.^...^.^.....^.^.....^...^.^.^.....^.^...^.^................................................
.............................................................................................................................................
...............................................^.........^.^.^.^.^.^.^.^...^.^.^.^...........^...............................................
.............................................................................................................................................
..............................................^.^.......^...^...^...^...^.^.^.^.^.^.^.^.^.^.^.^..............................................
.............................................................................................................................................
.............................................^.........^.^.^.^.^.^.^...^.^.^.^.^...^.^.^.^.^.^.^.............................................
.............................................................................................................................................
............................................^.^...^...^.^.^.^.^.^.^.^.^...^.^.^.^.^.^.^.^.^.^.^.^............................................
.............................................................................................................................................
...........................................^.^.^.^...^.^.^.^.^.^.....^.^.^.^.^.^.^...^.^.^.^.^...^...........................................
.............................................................................................................................................
..........................................^.....^.^.......^.^.^.^.^.^.^.....^.^.^.^.....^.^.^.^.^.^..........................................
.............................................................................................................................................
.........................................^.....^.^.^.^.^.^.^...^.^.^.....^.....^.^.....^.^.......^.^.........................................
.............................................................................................................................................
........................................^.^...^.^.^.^...^...^.^.^.^.^...^.^.^.^...^.....^.^.^...^...^........................................
.............................................................................................................................................
.......................................^.^.^.^.^.......^...^.^.^.^...^...^.^.^...^...^.^.^...........^.......................................
.............................................................................................................................................
......................................^.^...^.^.^.^...^...^.^.^.........^.^.^.^...^.^.^.^...^...^.....^......................................
.............................................................................................................................................
.....................................^.........^.^.^.^.^.^...^.........^.^.^.^.^.^.^.^.^...^.^.^...^...^.....................................
.............................................................................................................................................
....................................^.^.^...^.^.^.....^.^.^.^.^.....^.^.^...^...^...^.^.^.^...^...^...^.^....................................
.............................................................................................................................................
...................................^...^.^.^.^.^...^...^...^...^.^.^.^.^...^.^.^...^...^.^.^.........^.^.^...................................
.............................................................................................................................................
..................................^.^.^.^...^.^.....^.^.^.^.^...^...^.^.^.^.....^...^...^.^...^.^...^.^...^..................................
.............................................................................................................................................
.................................^...^.^.^.^.^.^...^.^.^.^.^.^.^.^.......^...^.^.^.......^...^.^.^.^.^.^.^.^.................................
.............................................................................................................................................
................................^.^.^...^.^...^.^...^.^.^.^...^.^...^.^.^.^.....^.....^.^.^.^.^.......^...^.^................................
.............................................................................................................................................
...............................^.^.^...^.^.^...^.^.^.^.^.^.....^.^.^.^...^.^.^.^.^.^.^.....^.^.^.^.....^.....^...............................
.............................................................................................................................................
..............................^.^...^.^.^.^.^.^...^.^.^.^...^.^.^...^.^...^.^...^.^.^.^...^.^.....^.^.^.....^.^..............................
.............................................................................................................................................
.............................^.^.^.^.^...^.^.^.^.^...^...^.^.^.^.^.........^.^.^...^.^...^.^...^.^.^...^...^.^.^.............................
.............................................................................................................................................
............................^...^.^...^.^...^.^.^.^...^.^.^.^.^...^.^.......^.^.^.^...^.^...^.^.^...^.^.........^............................
.............................................................................................................................................
...........................^.^.^...^.^.^.^...^.^.^.....^.^.^.^.......^...^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.^...^...^.^...........................
.............................................................................................................................................
..........................^.^...^...^.^.^...^.^.^.^.^.^.^.^...^.^.^.^...^.^.^.^.^.^...^...^.^.^.^...^.^.^.^.^...^.^..........................
.............................................................................................................................................
.........................^.^.^...^.^.^...^.^.^.^.....^.^...^...^.^...^.^.....^...^.^.^.^.^.^.^.....^.^.^.......^...^.........................
.............................................................................................................................................
........................^...^.^.^.^.^.^...^.^...^.^...^.^.........^.^.....^.^.^...........^...^.^.^.^...^.^.^.^.^.^.^........................
.............................................................................................................................................
.......................^.^.^.....^.^.^.....^.^.^.^.^.^...^.^.^...^.^.^.^.^...^.....^.^...^.^.^...^.^.^.^...^.^.^.^.^.^.......................
.............................................................................................................................................
......................^.^.^.^.^.^...^...^.^.......^...^.^...^.^...^.^.^.^.^.^.^...^.....^...^...^...^.^...^.^...^.^.^.^......................
.............................................................................................................................................
.....................^.^...^.^.^.^.^...^.^.^...^.^.^.^...^...^.^.^...^.....^.^.^.^.^.^.^.^.....^.^.^.^.^.^.^.^.^...^.^.^.....................
.............................................................................................................................................
....................^...^.^.^.^.^.....^.^.^.......^.^.^.^.^.^.^.^.......^...^...^.^.....^.....^...^.^...^.^.^.^.^.^.^...^....................
.............................................................................................................................................
...................^.^...^.^.^.^.^.^.^.^.............^.........^.^.^...^...^...^.^.........^.^.....^.^...^.....^.^.^.^...^...................
.............................................................................................................................................
..................^.^.^.^.^.^.^.^.^.^.^.^...^.^.^.^.^.^.....^...^.^.^.^.........^.^...^...^.^.......^.....^.^.^.....^.^...^..................
.............................................................................................................................................
.................^.^.^...^...^.^.^.^.^.^.^.^.^.^...^...^.^...^.^.^.^...^.^.^.^.^.^.^...^.^.......^.^...^.^.........^...^.^.^.................
.............................................................................................................................................
................^.^.^.....^...^.^...^.^.^.^.^.^...^.^...^.^.^.^.^.^.....^.^.^.^.^.....^...^.....^.^.^.....^.^.^.^.^...^.^...^................
.............................................................................................................................................
...............^.^.....^.^...^...^...^.^.^.......^...^.^...^.^.^...^.^.^.......^.^...^.^.^...^...^.^.....^...^...^.^.....^...^...............
.............................................................................................................................................
..............^.^.^.....^.^.^.^.^...^...^.^...^...^.^.^.....^...^.^.^.^.^...^.^.^.^.......^.^.....^...^.^...^.^.^...^.^.^...^.^..............
.............................................................................................................................................
.............^.^.^.^.^.....^.^...^.^...^...^.^.^...^.^.^...^...^.^.^.^.^...^.^.^.^.^.^.^.^...^.^.^.^.^...^...^.^.^.^...^.....^.^.............
.............................................................................................................................................
............^.^.^...^.......^.^...^.^.^.......^.^...^.^.^...^.^.^...........^.^.^.^.^.^.^.^...^.^.^.^.^.^.^.......^.^.^.^.^.^.^.^............
.............................................................................................................................................
...........^.....^.^...^...^.^...^...^...^.^.^...^...^...^.^.^...^.....^...^...^...^.....^...^.....^.^.^...^.^.^...^.^...^.^.^.^.^...........
.............................................................................................................................................
..........^.^.^.^.^.......^.^.^.^.^.^.....^.....^.^...^.^.^...^.^.^.^...^.^.^.^.^.^.^.^.^.^.^.^.....^.^.^.^.^.^...^.^.....^...^.^.^..........
.............................................................................................................................................
.........^...^.^.^...^.^.^.^.^.....^...^...^.^.^...^.^.^...^...^.^.^...^.^.^.^.^.^...^.^.^.^.^.^.^.^.^.^...^.....^.^.^.......^.^.^.^.........
.............................................................................................................................................
........^.^.^.^.^.^.^.....^.^.^.^.^.^.^.^.......^.^.^.^.^.^.^...^.^.^.....^...^.^.....^.^.^.^...^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.....^.^........
.............................................................................................................................................
.......^.^.......^.^.^.^.^.^.^...^.^.^.^.......^.....^...^.^.^.^.^.^.^.^...^.^...^...^.^.....^.^.....^...^.^.......^...^.^.^.^.^.^...^.......
.............................................................................................................................................
......^.^...^...^.^.^...^...^.^.^.^.^.^...^.^...^.....^.^.^.^.......^...^...^.^.....^.^.^.....^.^...^.^.....^.^.^.^.^.....^.....^.....^......
.............................................................................................................................................
.....^.^.^.^.....^.^.^.^.^.^.^...^.^.....^.^.^.....^.^.........^.^...^.^.....^...^.^.^.^.^.......^.^.....^.....^.^.^.^.^.^.^.....^.^...^.....
.............................................................................................................................................
....^...^.....^.^...^...^.^.^.........^.^.^.^.^.^.^.^.^.^.^.^...^.^.....^.....^.^.^.....^.^.^.^.^.^.....^.^.^.^.^...^.^.^.^...^.^.^.^...^....
.............................................................................................................................................
...^.....^.^.^.^...^.^.^.^.^.^.^...^.^.......^.^...^...^.^...^.^.^.......^.^.^.^.^.^.^.^.^...^.^.^.^...^.^.....^.^.^.^.^...^.^.^...^.^.^.^...
.............................................................................................................................................
..^.^.^.^...^.^.^.^.^...^.^.^.^.....^.^...^...^.^.^.^.....^.^.^.....^.^...^.^.^...^.^.^.........^.........................^.^.^.^.^.^...^.^..
.............................................................................................................................................
.^.^.....^.^.^.^.^.^.^...^.^.^...^.^...^.^.^.^...^.....^.^...^.^...^.^.^.^.....^...^.^...^...^.^.^.....^.^...^.^...^...^.^.^.^.^.^.^...^.^.^.
............................................................................................................................................."""
# ---------------------------------------------------------

def solve_timelines(grid_str):
    # Parse grid into a list of strings (ignoring the pipe characters '|' 
    # from the example diagrams, as we only need the map structure '.' and '^')
    # We clean the input to remove the illustrative path markers usually not in raw input
    lines = [line for line in grid_str.strip().split('\n')]
    
    # Note: If your raw input doesn't have the '|' drawn in, you don't need to strip them.
    # The logic below assumes the grid contains '.', '^', and 'S'.
    
    height = len(lines)
    width = len(lines[0])

    # Find Start (S)
    start_pos = None
    for r, line in enumerate(lines):
        if 'S' in line:
            start_pos = (r, line.find('S'))
            break
            
    if not start_pos:
        print("Error: Could not find start 'S'")
        return

    # Recursive function with Memoization to count paths
    @lru_cache(maxsize=None)
    def count_paths(r, c):
        # Base Case: If we reached the bottom row, this counts as 1 valid timeline
        if r == height - 1:
            return 1
        
        total_timelines = 0
        
        # Look at the cell directly below (r+1, c)
        if r + 1 < height:
            cell_below = lines[r+1][c]
            
            # Rule 1: If below is a splitter '^', we split Left and Right
            if cell_below == '^':
                # Move Down-Left (r+1, c-1)
                if c - 1 >= 0:
                    total_timelines += count_paths(r+1, c-1)
                # Move Down-Right (r+1, c+1)
                if c + 1 < width:
                    total_timelines += count_paths(r+1, c+1)
            
            # Rule 2: If below is empty '.', we fall Straight Down
            # (Treating 'S' as empty if we encounter it again, though unlikely)
            elif cell_below == '.' or cell_below == 'S' or cell_below == '|':
                 total_timelines += count_paths(r+1, c)
                 
        return total_timelines

    # Run the calculation
    result = count_paths(start_pos[0], start_pos[1])
    return result

# Run the solver
timelines = solve_timelines(input_grid)
print(f"Total active timelines: {timelines}")